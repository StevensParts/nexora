/* ===== Nexora ProSuite JavaScript ===== */

/**
 * Loader: hides after page load
 */
window.addEventListener("load", () => {
  const loader = document.querySelector(".loader");
  if (loader) {
    setTimeout(() => {
      loader.classList.add("hidden");
    }, 1200);
  }
});

/**
 * Modal logic for language + location
 */
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("welcomeModal");
  const closeBtn = document.getElementById("startBtn");
  const countrySelect = document.getElementById("country");
  const regionInput = document.getElementById("region");
  const postalInput = document.getElementById("postal");
  const languageSelect = document.getElementById("language");

  // Load saved preferences if exist
  const savedPrefs = JSON.parse(localStorage.getItem("nexoraPrefs"));
  if (savedPrefs) {
    applyPreferences(savedPrefs);
    modal.style.display = "none"; // Skip modal if already set
  } else {
    modal.style.display = "flex";
  }

  // Load countries + languages from JSON
  fetch("assets/data/countries.json")
    .then(res => res.json())
    .then(data => {
      // Populate countries
      data.countries.forEach(c => {
        const option = document.createElement("option");
        option.value = c.code;
        option.textContent = c.name;
        countrySelect.appendChild(option);
      });
      // Populate languages
      data.languages.forEach(l => {
        const option = document.createElement("option");
        option.value = l.code;
        option.textContent = l.name;
        languageSelect.appendChild(option);
      });
    })
    .catch(err => console.error("Error loading countries.json:", err));

  // Handle Save & Start
  if (closeBtn) {
    closeBtn.addEventListener("click", () => {
      const prefs = {
        country: countrySelect.value,
        region: regionInput.value,
        postal: postalInput.value,
        language: languageSelect.value
      };
      localStorage.setItem("nexoraPrefs", JSON.stringify(prefs));
      applyPreferences(prefs);
      modal.style.display = "none";
    });
  }
});

/**
 * Apply preferences to the site
 * - Updates language
 * - Updates text if translations available
 */
function applyPreferences(prefs) {
  console.log("User preferences loaded:", prefs);

  // Placeholder: dynamic translations (example only)
  if (prefs.language === "es") {
    translateToSpanish();
  } else if (prefs.language === "fr") {
    translateToFrench();
  }
}

/**
 * Example translation functions
 * In production, load from assets/data/translations.json
 */
function translateToSpanish() {
  const heroTitle = document.querySelector(".hero h1");
  if (heroTitle) heroTitle.textContent = "Bienvenido a Nexora ProSuite";
  const heroDesc = document.querySelector(".hero p");
  if (heroDesc) heroDesc.textContent = "Conectando el mundo con un portal exclusivo.";
}

function translateToFrench() {
  const heroTitle = document.querySelector(".hero h1");
  if (heroTitle) heroTitle.textContent = "Bienvenue sur Nexora ProSuite";
  const heroDesc = document.querySelector(".hero p");
  if (heroDesc) heroDesc.textContent = "Connecter le monde avec un portail exclusif.";
}
