/* ================================
   Nexora ProSuite - Main JS Logic
   Handles Loader, Modal, Language,
   Location, and LocalStorage
================================= */

// Wait for DOM
document.addEventListener("DOMContentLoaded", () => {
  // ===== Loader =====
  const loader = document.querySelector(".loader");
  setTimeout(() => {
    loader.classList.add("hidden");
  }, 1500);

  // ===== Modal =====
  const modal = document.getElementById("welcomeModal");
  const modalClose = document.getElementById("closeModal");
  const modalSave = document.getElementById("savePreferences");

  // Inputs
  const countrySelect = document.getElementById("country");
  const regionInput = document.getElementById("region");
  const postalInput = document.getElementById("postal");
  const languageSelect = document.getElementById("language");

  // Show modal only if preferences not set
  const prefs = JSON.parse(localStorage.getItem("nexoraPreferences"));
  if (!prefs) {
    modal.style.display = "flex";
  } else {
    applyPreferences(prefs);
  }

  // Load countries.json
  fetch("assets/data/countries.json")
    .then((res) => res.json())
    .then((data) => {
      countrySelect.innerHTML = `<option value="">Select Country</option>`;
      data.countries.forEach((c) => {
        const opt = document.createElement("option");
        opt.value = c.code;
        opt.textContent = c.name;
        countrySelect.appendChild(opt);
      });
    })
    .catch((err) => console.error("Error loading countries:", err));

  // Save button
  modalSave.addEventListener("click", () => {
    const preferences = {
      country: countrySelect.value,
      region: regionInput.value,
      postal: postalInput.value,
      language: languageSelect.value,
    };

    localStorage.setItem("nexoraPreferences", JSON.stringify(preferences));
    modal.style.display = "none";
    applyPreferences(preferences);
  });

  // Close button
  modalClose.addEventListener("click", () => {
    modal.style.display = "none";
  });
});

/* ===== Apply Preferences ===== */
function applyPreferences(prefs) {
  console.log("Loaded Preferences:", prefs);

  // Example: Auto-translate texts (simple mockup)
  if (prefs.language === "es") {
    document.querySelector("h1").textContent = "Bienvenido a Nexora ProSuite";
  } else if (prefs.language === "fr") {
    document.querySelector("h1").textContent = "Bienvenue Ã  Nexora ProSuite";
  } else {
    document.querySelector("h1").textContent = "Welcome to Nexora ProSuite";
  }

  // You can extend this with a full translation system
}
